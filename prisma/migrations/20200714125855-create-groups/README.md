# Migration `20200714125855-create-groups`

This migration has been generated by Andr√© 'Dezzy' at 7/14/2020, 12:58:55 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."groups" (
"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_CityToGroup" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."users" ADD COLUMN "groupId" text  NOT NULL ;

ALTER TABLE "public"."_CityToUser" DROP CONSTRAINT IF EXiSTS "_CityToUser_A_fkey";

ALTER TABLE "public"."_CityToUser" DROP CONSTRAINT IF EXiSTS "_CityToUser_B_fkey";

CREATE UNIQUE INDEX "_CityToGroup_AB_unique" ON "public"."_CityToGroup"("A","B")

CREATE  INDEX "_CityToGroup_B_index" ON "public"."_CityToGroup"("B")

ALTER TABLE "public"."_CityToGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."cities"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_CityToGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."groups"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."users" ADD FOREIGN KEY ("groupId")REFERENCES "public"."groups"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."_CityToUser";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200710153456-add-unique-flag-to-field-ibge..20200714125855-create-groups
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -499,14 +499,14 @@
 model City {
   @@map(name: "cities")
-  id      String    @default(uuid()) @id
-  name    String
-  uf      String
-  ibge    String    @unique
-  company Company[]
-  user    User[]
+  id        String    @default(uuid()) @id
+  name      String
+  uf        String
+  ibge      String    @unique
+  companies Company[]
+  groups    Group[]
 }
 model Company {
   @@map(name: "companies")
@@ -525,6 +525,16 @@
   id       String  @default(uuid()) @id
   username String
   email    String
   active   Boolean @default(true)
-  group    City[]
+  group    Group   @relation(fields: [groupId], references: [id])
+  groupId  String
 }
+
+model Group {
+  @@map(name: "groups")
+
+  id     String @default(uuid()) @id
+  name   String
+  cities City[]
+  users  User[]
+}
```


