# Migration `20200710131955-create-cities-and-users`

This migration has been generated by Andr√© 'Dezzy' at 7/10/2020, 1:19:56 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."cities" (
"ibge" text  NOT NULL ,
"id" text  NOT NULL ,
"name" text  NOT NULL ,
"uf" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."users" (
"active" boolean  NOT NULL DEFAULT true,
"email" text  NOT NULL ,
"id" text  NOT NULL ,
"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_CityToUser" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

ALTER TABLE "public"."companies" DROP COLUMN "city",
DROP COLUMN "ibge",
ADD COLUMN "cityId" text  NOT NULL ;

CREATE UNIQUE INDEX "_CityToUser_AB_unique" ON "public"."_CityToUser"("A","B")

CREATE  INDEX "_CityToUser_B_index" ON "public"."_CityToUser"("B")

ALTER TABLE "public"."_CityToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."cities"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_CityToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."companies" ADD FOREIGN KEY ("cityId")REFERENCES "public"."cities"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200708135437-create-companies..20200710131955-create-cities-and-users
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -496,14 +496,35 @@
   counterpartValue Float?
   yieldValue       Float?
 }
+model City {
+  @@map(name: "cities")
+
+  id      String    @default(uuid()) @id
+  name    String
+  uf      String
+  ibge    String
+  company Company[]
+  user    User[]
+}
+
 model Company {
   @@map(name: "companies")
   id     String @default(uuid()) @id
   cnpj   String @unique
   name   String
-  city   String
-  ibge   String
+  city   City   @relation(fields: [cityId], references: [id])
+  cityId String
   sphere String
 }
+
+model User {
+  @@map(name: "users")
+
+  id       String  @default(uuid()) @id
+  username String
+  email    String
+  active   Boolean @default(true)
+  group    City[]
+}
```


